// Generated by CoffeeScript 2.1.1
(function() {
  var init, menu;

  $(function() {
    return init();
  });

  init = function(scope = document) {
    var announcement_expand, checkmark_toggle, clipboard, composer_select_choose, composer_select_open, composer_select_search, ct_switch, ct_toggle, dropdown_toggle, grid_delete, modal_action, modal_close, modal_open, overlay, overlay_toggle, search_input, search_overlay, selectionData, server_item, system_messages_open, table_choice, user_toggle;
    dropdown_toggle = function(event) {
      event.stopImmediatePropagation();
      $('.expand').not($('.expand', this.parentElement)).slideUp();
      $('.menu > ul > li > a').not($(this)).removeClass('navActive');
      $(this).toggleClass('navActive');
      $('.expand', this.parentElement).slideToggle();
    };
    $('[data-trigger=\'[dropdown/toggle]\']', scope).on('click', dropdown_toggle);
    modal_open = function() {
      $('.overlay').fadeIn('fast');
      $('[data-component=\'' + this.getAttribute('data-trigger-target') + '\']').fadeIn('fast');
    };
    $('[data-trigger=\'[modal/open]\']', scope).on('click', modal_open);
    server_item = function() {
      $(this).toggleClass('toggableListActive');
      $(this).find('.content').fadeToggle('fast');
    };
    $('[data-trigger=\'[server/item]\']', scope).on('click', server_item);
    modal_close = function() {
      var parent;
      $('.overlay').fadeOut('fast');
      parent = this.parentElement;
      while (!$(parent).hasClass('modal')) {
        parent = parent.parentElement;
      }
      $(parent).fadeOut('fast');
    };
    $('[data-trigger=\'[modal/close]\']', scope).on('click', modal_close);
    overlay = function() {
      $('.overlay').fadeOut('fast');
      $('.modal').fadeOut('fast');
    };
    $('.overlay', scope).on('click', overlay);
    system_messages_open = function() {
      $('.notificationsArea', this).fadeToggle('fast');
      $($('a', this)[0]).toggleClass('userMenuActive');
    };
    $('[data-trigger=\'[system/messages/open]\']', scope).on('click', system_messages_open);
    search_overlay = function() {
      $('.searchOverlay').fadeOut('fast');
      $('.searchArea').fadeOut('fast');
      $('.search').animate({
        width: '20%'
      }, 250);
    };
    $('.searchOverlay', scope).on('click', search_overlay);
    announcement_expand = function() {
      $(this).find('.announcement-expand').slideToggle();
    };
    $('[data-trigger=\'[announcement/expand]\']', scope).on('click', announcement_expand);
    user_toggle = function() {
      $(this).find('.dropdown').fadeToggle('fast');
    };
    $('[data-trigger=\'[user/toggle]\']', scope).on('click', user_toggle);
    search_input = function() {
      $('.modal').fadeOut('fast');
      $('.searchOverlay').fadeIn('fast');
      $('.searchArea').fadeToggle('fast');
      $('.search').animate({
        width: '30%'
      }, 250);
    };
    $('.search input', scope).on('click', search_input);
    checkmark_toggle = function() {
      $(this.parentElement.parentElement).toggleClass('logSelected');
      $('.checkboxDialogue').not($('.checkboxDialogue', this.parentElement)).fadeOut('fast');
      if (!$('input', this)[0].checked) {
        $('.checkboxDialogue', this.parentElement).fadeIn('fast');
      } else {
        $('.checkboxDialogue', this.parentElement).fadeOut('fast');
      }
    };
    $('.timeTable tbody tr td .checkmarkContainer', scope).on('mousedown', checkmark_toggle);
    overlay_toggle = function() {
      var table;
      $(this.parentElement).fadeOut('fast');
      table = $(this).parent('tbody')[0];
      $('tr.logSelected', table).removeClass('logSelected');
      $('input:checked', table).forEach(function(e) {
        return e.checked = false;
      });
    };
    $('.timeTable tbody tr td .checkboxDialogue .paginationTabsDanger', scope).on('click', overlay_toggle);
    // retired
    $('[data-trigger=\'[modal/system/log/import/input/add]\']', scope).on('click', function() {
      $(this).parent().find('.appendInput').append('<input type=\'text\' placeholder=\'/home/server/addons/sourcemod/logs/error.log\' class=\'mbotSmall\'>');
    });
    composer_select_open = function() {
      event.stopImmediatePropagation();
      $(this).parent('._Dynamic_Select').toggleClass('_Dynamic_Select_Activated');
      $('._Select', $(this).parent('._Dynamic_Select')).toggleClass('selected');
      $('._Select_Search input', $(this).parent('._Dynamic_Select'))[0].focus();
    };
    $('[data-trigger="[composer/select/open]"]', scope).on('click', composer_select_open);
    selectionData = [];
    composer_select_choose = function() {
      var checkBox, i, text;
      event.stopImmediatePropagation();
      if ($('._Title', $(this).parent('._Dynamic_Select'))[0].getAttribute('data-select-multiple') === 'true') {
        text = $(this).find('p').text();
        checkBox = $(this).find('.checkmarkContainer input');
        if (!checkBox.is(':checked')) {
          checkBox.prop('checked', true);
          selectionData.push(text);
        } else {
          checkBox.prop('checked', false);
          i = 0;
          while (i < selectionData.length) {
            if (selectionData[i] === text) {
              selectionData.splice(i, 1);
              break;
            }
            i += 1;
          }
        }
        $(this).closest('._Dynamic_Select').find('._Title').text('(' + selectionData.length + ') selections');
        return;
      }
      $(this).parent('._Dynamic_Select').toggleClass('_Dynamic_Select_Activated');
      $('._Select', $(this).parent('._Dynamic_Select')).toggleClass('selected');
      $('._Title', $(this).parent('._Dynamic_Select'))[0].textContent = $('p', this)[0].textContent;
    };
    $('[data-trigger="[composer/select/choose]"]', scope).on('click', composer_select_choose);
    composer_select_search = function(e) {
      var container, distances, input, parent, values;
      event.stopImmediatePropagation();
      values = [];
      input = this.value;
      parent = $(this).parent('._Select');
      container = $('._Container', parent);
      $('p', container).forEach(function(node) {
        values.push(node);
      });
      if (this.value === '') {
        values.forEach(function(value) {
          return $(value).parent('li')[0].style.display = 'block';
        });
        return;
      }
      if (e.which >= 90 || e.which <= 48) {
        return;
      }
      distances = [];
      values.forEach(function(value) {
        $(value).parent('li')[0].style.display = 'none';
        return distances.push([value, distance(value.textContent, input)]);
      });
      distances.sort(function(a, b) {
        return b[1] - a[1];
      });
      distances = distances.slice(0, 5);
      distances.forEach(function(value) {
        return $(value[0]).parent('li')[0].style.display = 'block';
      });
      return console.log(distances);
    };
    $('[data-trigger="[composer/select/search]"]', scope).on('keyup', composer_select_search);
    ct_switch = function() {
      var hash;
      $('.paginationTabSelected', this.parentElement).removeClass('paginationTabSelected');
      hash = this.getAttribute('data');
      $(this).addClass('paginationTabSelected');
      history.replaceState({
        'location': window._.location,
        'scope': window._.scope
      }, null, `#${hash}`);
      window.lazy(this.parentElement.getAttribute('data-target'), '');
    };
    $('[data-trigger=\'[ct/switch]\']', scope).on('click', ct_switch);
    ct_toggle = function() {
      var index, parent;
      parent = this.parentElement;
      while (parent.nodeName.toLowerCase() !== 'tr') {
        parent = parent.parentElement;
      }
      index = -1;
      window.batch.forEach(function(e) {
        if (e.getAttribute('data-id') === parent.getAttribute('data-id')) {
          return index = window.batch.indexOf(e);
        }
      });
      if (index !== -1) {
        window.batch.splice(index, 1);
      }
      if (this.checked) {
        return window.batch.push(parent);
      }
    };
    $("[data-trigger='[ct/toggle]']", scope).on('change', ct_toggle);
    table_choice = function() {
      var mode, operation, parent;
      parent = $(this).parent('.modalSelect');
      mode = this.getAttribute('data-mode');
      operation = $('select', parent)[0].value;
      switch (operation) {
        case 'delete':
          return window.api.remove(mode, window.batch, true);
      }
    };
    $("[data-trigger='[table/choice]']", scope).on('click', table_choice);
    modal_action = function() {
      var action, mode, parent;
      parent = $(this).parent('.modal');
      mode = this.getAttribute('data-mode');
      action = this.getAttribute('data-mode');
      switch (action) {
        case 'delete':
          return window.api.remove(mode, parent[0], false);
      }
    };
    $("[data-trigger='[modal/action]']", scope).on('click', modal_action);
    grid_delete = function() {
      var mode, parent;
      parent = $(this).parent('.serverGridItem');
      mode = this.getAttribute('data-mode');
      return window.api.remove(mode, parent[0], false);
    };
    $("[data-trigger='[grid/delete]']", scope).on('click', grid_delete);
    clipboard = function(event) {
      return window.style.copy(this.getAttribute('data-clipboard-text'));
    };
    $('[data-trigger="[clip/copy]"]', scope).on('click', clipboard);
  };

  menu = function() {
    $('.paginationTabs').forEach(function(i) {
      var e, j, len, ref, results;
      ref = i.children;
      results = [];
      for (j = 0, len = ref.length; j < len; j++) {
        e = ref[j];
        if (window.location.hash && window.location.hash.substring(1) === e.getAttribute('data')) {
          results.push($(e).addClass('paginationTabSelected'));
        } else {
          results.push(void 0);
        }
      }
      return results;
    });
  };

  window._ = {
    init: init,
    menu: menu
  };

  window.batch = [];

}).call(this);
