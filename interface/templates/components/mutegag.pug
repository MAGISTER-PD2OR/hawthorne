- extends ajax|yesno:'skeleton/ajax.pug,skeleton/main.pug'
- load i18n
- load staticfiles

- block content
  .item.pure-u-1-1.pure-g
    .heading Mute/Gag
    .list#mutegag__user
      //- partials/mutegag/user.pug
    script.execution.
      window.ajax.mutegag.user(1)
    - if perms.core.add_mutegag
      .row.add.pure-g
        .column.icon.username.pure-u-7-24
          select#username-input
            option(placeholder) Username
        .column.icon.server.pure-u-7-24
          select#server-input
            option(placeholder) Server
        .column.icon.group.pure-u-7-24.input-wrapper
          input#inputduration(type='datetime-local')
          label(for='inputduration')
            i.skip(data-feather='clock')
        .column.icon.pure-u-3-24
          .spacer
          .action
            i.explicit.gray(data-feather="volume-x")
          .action
            i.explicit.gray(data-feather="message-circle")
        .column.icon.placeholder.pure-u-7-24
        .column.icon.group.pure-u-14-24.input-wrapper
          input#inputdescription(type='text')
          label.fix(for='inputdescription')
            i.skip(data-feather='paperclip')
        .column.icon.pure-u-3-24
          .spacer
          .action
            i(data-feather="plus")

        script.execution.
          var now = new Date()
            , year
            , month
            , date
            , hours
            , minutes
            , seconds
            , formattedDateTime
            ;

          year = now.getFullYear();
          month = now.getMonth().toString().length === 1 ? '0' + (now.getMonth() + 1).toString() : now.getMonth() + 1;
          date = now.getDate().toString().length === 1 ? '0' + (now.getDate()).toString() : now.getDate();
          hours = now.getHours().toString().length === 1 ? '0' + now.getHours().toString() : now.getHours();
          minutes = now.getMinutes().toString().length === 1 ? '0' + now.getMinutes().toString() : now.getMinutes();

          formattedDateTime = year + '-' + month + '-' + date + 'T' + hours + ':' + minutes;
          document.getElementById('inputduration').min = formattedDateTime;
          var usernameinput = new Choices('#username-input', {
            searchPlaceholderValue: "Steam Username",
            choices: [],
            noResultsText: 'Could not find user',
            noChoicesText: 'Type something to query',
            itemSelectText: 'Enter will do it',
          })
          debounce_search = function(value, input) {
            window.steam.search(value, input);
          }

          var call = _.debounce(debounce_search, 200);
          usernameinput.passedElement.addEventListener('search', function(event) {
            if (event.detail.value.length > 0) {
              call(event.detail.value, usernameinput);
            }
          }, false);

          var serverinput = new Choices('#server-input', {
            searchEnabled: false,
            choices: [],
          })

          window.api.servers('', serverinput)
