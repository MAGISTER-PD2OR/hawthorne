- extends ajax|yesno:'skeleton/ajax.pug,skeleton/main.pug'
- load i18n
- load staticfiles

- block content
  - if perms.core.view_user
    .item.pure-u-1-1.users
      .heading
       - trans "Administration"
      .list#admin__admin
        //- partials/admin/user.pug

      - if perms.core.add_user
        .row.add.pure-g
          .column.icon.username.pure-u-7-24
            select#username-input
              option(placeholder) Username
          .column.icon.group.pure-u-14-24
            select#group-input
              option(placeholder) Group
          .column.icon.pure-u-3-24
            .spacer
            .action(onclick="window.api.submit('admin__administrator')")
              i.explicit.hover.black(data-feather="user-plus")

          script.execution.
            var usernameinput = new Choices('#username-input', {
              searchPlaceholderValue: "Steam Username",
              choices: [],
              noResultsText: 'Could not find user',
              noChoicesText: 'Type something to query',
              itemSelectText: 'Enter will do it',
            })

            debounce_search = function(value, input) {
              window.steam.search(value, input);
            }

            var call = _.debounce(debounce_search, 200);
            usernameinput.passedElement.addEventListener('search', function(event) {
              if (event.detail.value.length > 0) {
                call(event.detail.value, usernameinput);
              }
            }, false);
            window.usernameinput = usernameinput

            var groupinput = new Choices('#group-input', {
              searchEnabled: false,
              choices: [],
            })
            window.groupinput = groupinput
            window.api.groups('', groupinput)

  - if perms.core.view_servergroup
    .item.pure-u-1-1.pure-u-lg-11-24.second
      .heading Groups
      .list#admin__group
        .row.pure-g
          .column.icon.username.pure-u-7-24
            i(data-feather="users")
            span root
          .column.icon.server.pure-u-7-24
            i(data-feather="trending-up")
            span 100%
          .column.icon.server.pure-u-7-24
            i(data-feather="clock")
            i.bpi-unlimited
          .column.icon.pure-u-3-24
          .column.icon.server.pure-u-7-24
            i.explicit.white(data-feather="hard-drive")
            i(data-feather="hard-drive")
            if data.server is not None
              = data.server.name
            else
              | all
          .column.icon.group.pure-u-14-24
            i(data-feather="zap")
            span (root)
        //- partials/admin/group.pug
        script.execution.
          window.ajax.admin.groups(1)

      - if perms.core.add_servergroup
        .row.add.pure-g
          .column.icon.group.pure-u-7-24.input-wrapper
            input#inputgroupname(type='text')
            label.adjusted(for='inputgroupname')
              i.skip(data-feather='users')
          .column.icon.immunity.pure-u-7-24.input-wrapper
            input#inputimmunityvalue(type='number', min='0', max='100', onkeypress="return isNumeric(event)", oninput="maxLengthCheck(this)", value="0")
            label.adjusted(for='inputimmunityvalue')
              i.skip.adjusted(data-feather='trending-up')
            .appendix %

            script.execution.
              function maxLengthCheck(object) {
                if (object.value > object.max && object.value.length === object.max.length)
                  object.value = object.max
                if (object.value.length > object.max.length)
                  object.value = object.value.slice(0, object.max.length)
              }

              function isNumeric (evt) {
                var theEvent = evt || window.event;
                var key = theEvent.keyCode || theEvent.which;
                key = String.fromCharCode (key);
                var regex = /[0-9]|\./;
                if ( !regex.test(key) ) {
                  theEvent.returnValue = false;
                  if(theEvent.preventDefault) theEvent.preventDefault();
                }
              }

          .column.icon.time.pure-u-7-24.input-wrapper
            input#inputtimevalue(type='text', placeholder='11h 6m')
            label.adjusted(for='inputtimevalue')
              i.skip(data-feather='clock')
          .column.icon.pure-u-3-24
          .column.icon.server.pure-u-7-24
            select#server-input
              option(placeholder) Server
          .column.icon.server.pure-u-14-24
            i(data-feather="zap")
            .actions.enabled
              input(type='checkbox', id="reservation-input").tiny
              label.tiny(for="reservation-input", data-description='eservation') R
              input(type='checkbox', id="genericinput").tiny
              label.tiny(for="genericinput", data-description='eneric') G
              input(type='checkbox', id="kick-input").tiny
              label.tiny(for="kick-input", data-description='ick') K
              input(type='checkbox', id="ban-input").tiny
              label.tiny(for="ban-input", data-description='an') B
              input(type='checkbox', id="slay-input").tiny
              label.tiny(for="slay-input", data-description='lay') S
              input(type='checkbox', id="map-input").tiny
              label.tiny(for="map-input", data-description='ap') M
              input(type='checkbox', id="cvar-input").tiny
              label.tiny(for="cvar-input", data-description='Var') C
              input(type='checkbox', id="config-input").tiny
              label.tiny(for="config-input", data-description='onfig') C
              input(type='checkbox', id="chat-input").tiny
              label.tiny(for="chat-input", data-description='hat') C
              input(type='checkbox', id="vote-input").tiny
              label.tiny(for="vote-input", data-description='ote') V
              input(type='checkbox', id="password-input").tiny
              label.tiny(for="password-input",data-description='assword') P
              input(type='checkbox', id="rcon-input").tiny
              label.tiny(for="rcon-input", data-description='Con') R
              input(type='checkbox', id="cheat-input").tiny
              label.tiny(for="cheat-input", data-description='heats') C
          script.execution.
            var serverinput = new Choices('#server-input', {
              searchEnabled: false,
              choices: [],
            })
            window.api.servers('', serverinput)
            window.ajax.admin.admins(1)

          .column.icon.pure-u-3-24
            .spacer
            .action
              i(data-feather="plus")

  .spacer

  - if perms.core.view_chat
    .item.pure-u-1-1.pure-u-lg-11-24.second
      .heading
        - trans "Logs"
      .list
        .row.pure-g#admin__log
          //- partials/admin/group.pug
        script.execution.
          window.ajax.admin.logs(1)
